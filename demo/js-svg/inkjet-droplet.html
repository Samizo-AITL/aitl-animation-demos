<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inkjet Droplet Formation (SVG Realistic)</title>

<style>
body {
  margin:0;
  background:#020617;
  color:#e5e7eb;
  font-family: monospace;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

h1 {
  font-size:16px;
  margin-bottom:10px;
}

svg {
  background:#020617;
  border:1px solid #334155;
}
</style>
</head>

<body>
<h1>Inkjet Droplet Formation (SVG Realistic)</h1>

<svg width="400" height="520" viewBox="0 0 400 520">

<!-- ================= defs ================= -->
<defs>
  <!-- 液体グラデーション -->
  <radialGradient id="inkGrad" cx="50%" cy="25%" r="75%">
    <stop offset="0%" stop-color="#bae6fd"/>
    <stop offset="60%" stop-color="#38bdf8"/>
    <stop offset="100%" stop-color="#0284c7"/>
  </radialGradient>

  <!-- グロー -->
  <filter id="glow">
    <feGaussianBlur stdDeviation="3" result="blur"/>
    <feMerge>
      <feMergeNode in="blur"/>
      <feMergeNode in="SourceGraphic"/>
    </feMerge>
  </filter>
</defs>

<!-- ================= ノズル ================= -->
<rect x="140" y="20" width="120" height="40" rx="4" fill="#64748b"/>

<!-- ================= 液柱 ================= -->
<path id="jet"
  fill="url(#inkGrad)"
  filter="url(#glow)"
  d=""/>

<!-- ================= 主液滴 ================= -->
<ellipse id="drop"
  cx="200" cy="200"
  rx="18" ry="16"
  fill="url(#inkGrad)"
  filter="url(#glow)"
  opacity="0"/>

<!-- ================= サテライト ================= -->
<circle id="sat1" r="4" cx="200" cy="180"
  fill="url(#inkGrad)" filter="url(#glow)" opacity="0"/>
<circle id="sat2" r="3" cx="200" cy="165"
  fill="url(#inkGrad)" filter="url(#glow)" opacity="0"/>

</svg>

<script>
const jet  = document.getElementById("jet");
const drop = document.getElementById("drop");
const s1   = document.getElementById("sat1");
const s2   = document.getElementById("sat2");

let t = 0;

/* 状態 */
let dropY = 200, vDrop = 0;
let s1Y = 180, vS1 = 0;
let s2Y = 165, vS2 = 0;

function jetPath(len, neck) {
  const xL = 200 - neck;
  const xR = 200 + neck;
  const y0 = 60;
  const y1 = 60 + len;

  return `
    M ${xL} ${y0}
    C ${xL-4} ${y0+40}, ${xL-6} ${y1-40}, ${xL} ${y1}
    L ${xR} ${y1}
    C ${xR+6} ${y1-40}, ${xR+4} ${y0+40}, ${xR} ${y0}
    Z
  `;
}

function reset() {
  t = 0;
  drop.setAttribute("opacity", 0);
  s1.setAttribute("opacity", 0);
  s2.setAttribute("opacity", 0);

  dropY = 200; vDrop = 0;
  s1Y = 180; vS1 = 0;
  s2Y = 165; vS2 = 0;
}

function step() {
  t++;

  /* ---- Phase 1: 伸長 ---- */
  if (t < 30) {
    const len = t * 3;
    jet.setAttribute("d", jetPath(len, 12));
  }

  /* ---- Phase 2: ネック形成 ---- */
  if (t >= 30 && t < 55) {
    const dt = t - 30;
    const len = 90 + dt * 1.2;
    const neck = 12 - dt * 0.35;
    jet.setAttribute("d", jetPath(len, Math.max(neck, 2)));

    drop.setAttribute("opacity", 1);
    drop.setAttribute("cy", 60 + len + 18);
  }

  /* ---- Phase 3: ピンチオフ ---- */
  if (t === 55) {
    jet.setAttribute("d", jetPath(70, 2));

    drop.setAttribute("opacity", 1);
    s1.setAttribute("opacity", 1);
    s2.setAttribute("opacity", 1);

    vDrop = 2.8;
    vS1 = 2.2;
    vS2 = 1.6;
  }

  /* ---- Phase 4: 飛翔 + 振動 ---- */
  if (t > 55 && t < 150) {
    vDrop += 0.05;
    dropY += vDrop;
    drop.setAttribute("cy", dropY);

    const osc = Math.exp(-(t-55)/35) * Math.sin((t-55)/4);
    drop.setAttribute("rx", 18 + osc*2.5);
    drop.setAttribute("ry", 16 - osc*2.5);

    vS1 += 0.04; s1Y += vS1;
    vS2 += 0.03; s2Y += vS2;
    s1.setAttribute("cy", s1Y);
    s2.setAttribute("cy", s2Y);
  }

  if (t > 190) reset();

  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
