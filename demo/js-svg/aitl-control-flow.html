<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AITL Control Flow Demo — PID × FSM × NN × RL × LLM</title>

<style>
:root{
  --bg:#020617;
  --panel:#0b1222cc;
  --stroke:#38bdf8;
  --muted:#94a3b8;
  --grid:#1f2a44;
  --shadow:0 20px 60px rgba(0,0,0,.55);

  --ok:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;

  --set:#94a3b8;
  --resp:#38bdf8;
  --cand:#a78bfa;
  --act:#22c55e;
}

*{box-sizing:border-box;}
html, body{
  margin:0;
  padding:0;
  background:#000;
  color:#e5e7eb;
  font-family:ui-monospace, Menlo, Consolas, monospace;
}

.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:14px;
  background:
    radial-gradient(1200px 700px at 50% -10%, rgba(56,189,248,.12), transparent 55%),
    radial-gradient(900px 600px at 15% 10%, rgba(34,197,94,.08), transparent 55%),
    radial-gradient(900px 600px at 85% 20%, rgba(239,68,68,.07), transparent 55%),
    var(--bg);
}

h1{
  font-size:13.5px;
  letter-spacing:.14em;
  margin:6px 0 14px;
  color:#cbd5e1;
}

.panel{
  display:grid;
  grid-template-columns:320px 1fr;
  gap:18px;
}

.card{
  background:linear-gradient(180deg, rgba(11,18,34,.85), rgba(11,18,34,.55));
  border:1px solid rgba(148,163,184,.22);
  border-radius:16px;
  box-shadow:var(--shadow);
  overflow:hidden;
}

.cardHeader{
  padding:14px;
  border-bottom:1px solid rgba(148,163,184,.14);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.pulseDot{
  width:8px;height:8px;border-radius:50%;
  background:#38bdf8;
  box-shadow:0 0 12px #38bdf8;
  animation:pulse 1.2s infinite;
  margin-right:8px;
}
@keyframes pulse{0%,100%{opacity:.9;}50%{opacity:.4;}}

.badge{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.22);
  background:rgba(2,6,23,.25);
}

.status{padding:14px;font-size:12.5px;}

.row{
  display:flex;
  justify-content:space-between;
  padding:8px 10px;
  margin-bottom:8px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.12);
  background:rgba(2,6,23,.35);
}

.kpi{
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.12);
  background:rgba(2,6,23,.35);
}
.kpi .label{font-size:11px;color:var(--muted);}
.kpi .num{font-size:16px;margin-top:4px;}

.footerNote{
  padding:10px 14px;
  border-top:1px solid rgba(148,163,184,.14);
  font-size:11px;
  color:var(--muted);
  line-height:1.5;
}

/* ===== SVG ===== */
.svgWrap{position:relative;}
svg{
  display:block;
  width:100%;
  height:340px;
  background:#020617;
}

.legend{
  position:absolute;
  top:12px;left:14px;
  font-size:11px;
  color:var(--muted);
  display:flex;
  gap:10px;
}
.chip{
  display:flex;align-items:center;gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,.18);
  background:rgba(2,6,23,.35);
}
.swatch{width:10px;height:10px;border-radius:3px;}
.sw1{background:var(--set);}
.sw2{background:var(--resp);}
</style>
</head>

<body>
<div class="wrap">
<h1>AITL CONTROL FLOW DEMO — PID × FSM × NN × RL × LLM</h1>

<div class="panel">

<div class="card">
  <div class="cardHeader">
    <div style="display:flex;align-items:center;">
      <span class="pulseDot"></span>LIVE
    </div>
    <span class="badge">FSM is the sole decision authority</span>
  </div>

  <div class="status">
    <div class="row"><span>FSM State</span><span id="fsm">NORMAL</span></div>
    <div class="row"><span>PID</span><span id="pid">tracking</span></div>
    <div class="row"><span>NN</span><span id="nn">idle</span></div>
    <div class="row"><span>RL</span><span id="rl">idle</span></div>
    <div class="row"><span>LLM</span><span id="llm">idle</span></div>

    <div class="kpi">
      <div class="label">Normalized error |e|</div>
      <div class="num" id="err">0.00</div>
    </div>
  </div>

  <div class="footerNote">
    NN and RL generate proposals only.  
    FSM evaluates and authorizes.  
    LLM is invoked only when the control logic itself must be reconsidered.
  </div>
</div>

<div class="card svgWrap">
  <div class="legend">
    <div class="chip"><span class="swatch sw1"></span>Setpoint</div>
    <div class="chip"><span class="swatch sw2"></span>Response</div>
  </div>

  <svg viewBox="0 0 860 300">
    <defs>
      <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
        <path d="M40 0 L0 0 0 40" stroke="rgba(31,42,68,.8)" fill="none"/>
      </pattern>
    </defs>

    <rect width="860" height="300" fill="url(#grid)"/>
    <rect x="40" y="20" width="800" height="240" rx="10"
          fill="rgba(2,6,23,.35)" stroke="rgba(148,163,184,.22)"/>

    <path id="setPath" stroke="#94a3b8" stroke-dasharray="6 6" fill="none"/>
    <path id="pidPath" stroke="#38bdf8" stroke-width="3" fill="none"/>
  </svg>
</div>

</div>
</div>

<script>
const N=240, SET=1.0;
const X0=40,Y0=20,W=800,H=240;

const fsmEl=document.getElementById("fsm");
const pidEl=document.getElementById("pid");
const nnEl=document.getElementById("nn");
const rlEl=document.getElementById("rl");
const llmEl=document.getElementById("llm");
const errEl=document.getElementById("err");

const pidPath=document.getElementById("pidPath");
const setPath=document.getElementById("setPath");

let i=0;
let Kp=0.9;
let fsm="NORMAL";

const px=[], sx=[];
const X=i=>X0+(i/(N-1))*W;
const Y=v=>Y0+H-(v*H);

function path(p,n){
  if(n<2) return "";
  return "M "+p.slice(0,n).map(q=>q.x+" "+q.y).join(" L ");
}

function step(){
  let y=SET*(1-Math.exp(-Kp*i/18));
  if(i>70&&i<120) y-=0.32;

  const e=Math.abs(SET-y);
  errEl.textContent=e.toFixed(2);

  if(e>0.22 && fsm==="NORMAL"){
    fsm="DEGRADED";
    nnEl.textContent="proposing";
    rlEl.textContent="selecting";
  }

  if(fsm==="DEGRADED" && i===150){
    Kp=2.1;
    fsm="RECOVERY";
    llmEl.textContent="proposal adopted";
  }

  if(fsm==="RECOVERY" && e<0.1){
    fsm="NORMAL";
    nnEl.textContent="idle";
    rlEl.textContent="idle";
    llmEl.textContent="idle";
  }

  fsmEl.textContent=fsm;
  pidEl.textContent=fsm==="NORMAL"?"tracking":"adjusting";

  px[i]={x:X(i),y:Y(Math.max(0,Math.min(1.05,y)))};
  sx[i]={x:X(i),y:Y(SET)};

  pidPath.setAttribute("d",path(px,i+1));
  setPath.setAttribute("d",path(sx,i+1));

  i++;
  if(i>=N){
    i=0;fsm="NORMAL";Kp=0.9;
    px.length=0;sx.length=0;
  }
  requestAnimationFrame(step);
}
step();
</script>
</body>
</html>
